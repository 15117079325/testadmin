
{if $full_page}
{include file="pageheader.htm"}
{insert_scripts files="../js/utils.js,listtable.js"}
<div class="form-div">
  <form action="suggestions_manage.php?act=list" name="searchForm">
    <img src="images/icon_search.gif" width="26" height="22" border="0" alt="SEARCH" />
    输入意见内容<input type="text" name="keyword" id="key"/>
    <select name="status">
      <option value="0">全部</option>
      <option value="1" {if $filter.status==1}selected{/if}>未处理</option>
      <option value="2" {if $filter.status==2}selected{/if}>已处理</option>
    </select>
    <input type="submit" id="sub" onclick="reload();" class="button" value="{$lang.button_search}" />

  </form>
</div>

<!--<form method="POST" action="comment_manage.php?act=batch_drop" name="listForm" onsubmit="return confirm_bath()">-->
<form method="POST" action="suggestions_manage.php?act=query" name="listForm" onsubmit="return confirm_bath()">
  <!-- start comment list -->
  <div class="list-div" id="listDiv">
    {/if}

<table cellpadding="3" cellspacing="1">
  <tr>
    <th>编号</th>
    <th>用户id</th>
    <th>联系人</th>
    <th>联系人电话</th>
    <th>意见内容</th>
    <th>是否已处理</th>
    <th>相关图片</th>
    <th>添加时间</th>
    <th>{$lang.handler}</th>
  </tr>
  {foreach from=$suggestions_list item=suggestions}
  <tr>
    <td><input value="{$suggestions.fb_id}" name="checkboxes" type="checkbox">{$suggestions.fb_id}</td>
    <td>{$suggestions.user_id}</td>
    <td>{$suggestions.user_name}</td>
    <td>{$suggestions.mobile_phone}</td>
    <td>{$suggestions.fb_content}</td>
    <td align="center"><img src="images/{if $suggestions.fb_status==2}yes{else}no{/if}.gif" onclick="update_status(this,'fb_status',{$suggestions.fb_id})" data="{$suggestions.fb_status}"/></td>
    <td>
      {if $suggestions.image}
     {foreach from=$suggestions.image item=image}
      <img src="{$image}" width="50px" >
    {/foreach}
      {/if}
    </td>
    <td>{$suggestions.fb_gmt_create}</td>
    <td align="center">
      <a href="javascript:" onclick="removeSuggestion({$suggestions.fb_id},'{$lang.drop_confirm}')">{$lang.remove}</a>
    </td>
  </tr>
    {foreachelse}
    <tr><td class="no-records" colspan="10">{$lang.no_records}</td></tr>
    {/foreach}
  </table>

  <table cellpadding="4" cellspacing="0">
    <tr>
      <td>
      <div>
      <input type="hidden" name="act" value="batch" />
      <input type="button" name="drop" id="btnSubmit"  onclick="batchRemove('你确定要删除所选意见吗？')" value="批量删除" class="button" disabled="true" /></div></td>
      <td align="right">{include file="page.htm"}</td>
    </tr>
  </table>

{if $full_page}
</div>
<!-- end comment list -->

</form>
<script type="text/javascript">

  function update_status(obj,key,id){
      var status = $(obj).attr('data');
        $.ajax({
                type:'post',
                url:'suggestions_manage.php?act=update_status',
                data:{key:key,id:id,status:status},
                dataType:'json',
                success:function(data){  //请求成功回调函数
                    var status = data.status; //获取返回值
                    if(status == 2){  //判断状态码，200为成功
                        $(obj).attr('data',status);
                        $(obj).attr('src','images/yes.gif');
                    }else{
                        $(obj).attr('data',status);
                       $(obj).attr('src','images/no.gif');
                    }
                },
            });
  }
  /* 异步批量删除 */
  function batchRemove(cfm){
      if(confirm(cfm)){
          obj = document.getElementsByName("checkboxes");
          ids = [];
          for(k in obj){
              if(obj[k].checked)
                  ids.push(obj[k].value);
          }
          //异步发送数据
          $.ajax(
              {
                  type:'GET',
                  url:'suggestions_manage.php?act=batch',
                  data:'ids='+ids,
                  success:function(data){
                      var data=eval("("+data+")");
                      alert(data.msg);
                      location.reload();
                  }
              })
      }
  }

  /* 异步单个删除*/
    function removeSuggestion(id,cfm){
        if(confirm(cfm)){
            //确定删除
            $.ajax({
                type:'GET',
                url:'suggestions_manage.php?act=remove',
                data:'id='+id,

                success:function(data){
                    var data = eval("("+data+")");
                        alert(data.msg);
                        location.reload();
                }
            }

        )

        }

    }

</script>

<script type="text/javascript" language="JavaScript">
  function reload(){
      var keyword=document.getElementById('key').value;
      if(keyword===""){
          location.reload();
      }
  }

  {literal}
  onload = function()
  {
      document.forms['searchForm'].elements['keyword'].focus();
      // 开始检查订单
      startCheckOrder();
  }
  /**
   * 搜索评论
   */
  function searchComment()
  {
      var keyword = Utils.trim(document.forms['searchForm'].elements['keyword'].value);
      if (keyword.length > 0)
      {
        listTable.filter['keywords'] = keyword;
        listTable.filter.page = 1;
        listTable.loadList();
      }
      else
      {
          document.forms['searchForm'].elements['keyword'].focus();
      }
  }
  {/literal}

  function confirm_bath()
  {
    var action = document.forms['listForm'].elements['sel_action'].value;

    return confirm(cfm[action]);
  }

</script>
{include file="pagefooter.htm"}
{/if}
